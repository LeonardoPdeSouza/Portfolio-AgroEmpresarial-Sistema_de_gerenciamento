package br.com.tcc.view;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
import br.com.tcc.entity.Pagamento;
import br.com.tcc.entity.Vendaregistro;
import br.com.tcc.util.EntityManagerUtil;
import br.com.tcc.util.Uteis;
import java.awt.Color;
import java.math.BigDecimal;
import java.util.List;
import javax.swing.JOptionPane;

/**
 *
 * @author Leonardo P Souza
 */
public class ContaReceberView extends javax.swing.JFrame {

    double valorFinal = 0.0;

    public ContaReceberView() {
        initComponents();
        int row = vendaRegistroList.size() - 1;
        if (row >= 0) {
            tblObjetos.setRowSelectionInterval(0, 0);
            tblObjetos.scrollRectToVisible(tblObjetos.getCellRect(0, 0, true));
            pnlPagamento.setEnabled(false);
            btnPagamento.setEnabled(false);
        } else {
            String sql = "from Vendaregistro pr";
            vendaRegistroQuery = entityManager.createQuery(sql);
            vendaRegistroList.clear();
            vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();

        entityManager = EntityManagerUtil.getEntityManager();
        tipoPagamentoQuery = java.beans.Beans.isDesignTime() ? null : entityManager.createQuery("SELECT tp FROM Tipopagamento tp");
        tipoPagamentoList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : org.jdesktop.observablecollections.ObservableCollections.observableList(tipoPagamentoQuery.getResultList());
        vendaRegistroQuery = java.beans.Beans.isDesignTime() ? null : entityManager.createQuery("from Vendaregistro pr where ativo = 'Pendente'");
        vendaRegistroList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : org.jdesktop.observablecollections.ObservableCollections.observableList(vendaRegistroQuery.getResultList());
        clienteQuery = java.beans.Beans.isDesignTime() ? null : entityManager.createQuery("SELECT c FROM Cliente c");
        clienteList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : org.jdesktop.observablecollections.ObservableCollections.observableList(clienteQuery.getResultList());
        funcionarioQuery = java.beans.Beans.isDesignTime() ? null : entityManager.createQuery("SELECT f FROM Funcionario f");
        funcionarioList = java.beans.Beans.isDesignTime() ? java.util.Collections.emptyList() : org.jdesktop.observablecollections.ObservableCollections.observableList(funcionarioQuery.getResultList());
        jScrollPane1 = new javax.swing.JScrollPane();
        tblObjetos = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();
        cbxFechamento = new javax.swing.JComboBox();
        jLabel2 = new javax.swing.JLabel();
        cbxOrdem = new javax.swing.JComboBox();
        btnBuscas = new javax.swing.JButton();
        txtFiltro = new javax.swing.JTextField();
        jPanel1 = new javax.swing.JPanel();
        btnTodos = new javax.swing.JButton();
        btnPendentes = new javax.swing.JButton();
        btnPagas = new javax.swing.JButton();
        btnAtrasadas = new javax.swing.JButton();
        btnAlterar = new javax.swing.JButton();
        btnPagamento = new javax.swing.JButton();
        pnlPagamento = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        txtRecebido = new javax.swing.JTextField();
        txtValorVenda = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txtDesconto = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        txtJuros = new javax.swing.JTextField();
        txtValorFinal = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        txtRestante = new javax.swing.JTextField();
        txtDias = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        btnIniciaPagamento = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Contas a Receber");

        org.jdesktop.swingbinding.JTableBinding jTableBinding = org.jdesktop.swingbinding.SwingBindings.createJTableBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, vendaRegistroList, tblObjetos);
        org.jdesktop.swingbinding.JTableBinding.ColumnBinding columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${id}"));
        columnBinding.setColumnName("Código");
        columnBinding.setColumnClass(Integer.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${idCliente}"));
        columnBinding.setColumnName("Cliente");
        columnBinding.setColumnClass(br.com.tcc.entity.Cliente.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${idFuncionario}"));
        columnBinding.setColumnName("Funcionario");
        columnBinding.setColumnClass(br.com.tcc.entity.Funcionario.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${idTipoPagamento}"));
        columnBinding.setColumnName("Pagamento");
        columnBinding.setColumnClass(br.com.tcc.entity.Tipopagamento.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${dataVenda}"));
        columnBinding.setColumnName("Data");
        columnBinding.setColumnClass(java.util.Date.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${vencimento}"));
        columnBinding.setColumnName("Venc.");
        columnBinding.setColumnClass(java.util.Date.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${totalVenda}"));
        columnBinding.setColumnName("Total");
        columnBinding.setColumnClass(Double.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${ativo}"));
        columnBinding.setColumnName("Ativo");
        columnBinding.setColumnClass(String.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${recebeu}"));
        columnBinding.setColumnName("Recebeu");
        columnBinding.setColumnClass(Double.class);
        columnBinding.setEditable(false);
        columnBinding = jTableBinding.addColumnBinding(org.jdesktop.beansbinding.ELProperty.create("${restante}"));
        columnBinding.setColumnName("Restante");
        columnBinding.setColumnClass(Double.class);
        columnBinding.setEditable(false);
        bindingGroup.addBinding(jTableBinding);
        jTableBinding.bind();
        jScrollPane1.setViewportView(tblObjetos);

        jLabel1.setText("Fechamento:");

        cbxFechamento.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Fechar Venda", "Abrir Venda" }));

        jLabel2.setText("Pesquisar por nome:");

        cbxOrdem.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Cliente", "Funcionário" }));

        btnBuscas.setText("Buscar");
        btnBuscas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnBuscasActionPerformed(evt);
            }
        });

        btnTodos.setText("Buscas Todos");
        btnTodos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTodosActionPerformed(evt);
            }
        });
        jPanel1.add(btnTodos);

        btnPendentes.setText("Buscas Pendentes");
        btnPendentes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPendentesActionPerformed(evt);
            }
        });
        jPanel1.add(btnPendentes);

        btnPagas.setText("Buscas Pagas");
        btnPagas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPagasActionPerformed(evt);
            }
        });
        jPanel1.add(btnPagas);

        btnAtrasadas.setText("Buscas Atrasadas");
        jPanel1.add(btnAtrasadas);

        btnAlterar.setText("Alterar");

        org.jdesktop.beansbinding.Binding binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement != null}"), btnAlterar, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        btnAlterar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAlterarActionPerformed(evt);
            }
        });

        btnPagamento.setText("Fazer Pagamento");
        btnPagamento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPagamentoActionPerformed(evt);
            }
        });

        pnlPagamento.setBorder(javax.swing.BorderFactory.createTitledBorder("Registrar Pagamento"));

        jLabel3.setText("Valor Recebido:");

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.recebeu}"), txtRecebido, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        txtRecebido.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtRecebidoFocusLost(evt);
            }
        });
        txtRecebido.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtRecebidoKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtRecebidoKeyTyped(evt);
            }
        });

        txtValorVenda.setEnabled(false);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.totalVenda}"), txtValorVenda, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        jLabel4.setText("Valor da venda:");

        jLabel5.setText("Desconto:");

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.desconto}"), txtDesconto, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        txtDesconto.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtDescontoKeyTyped(evt);
            }
        });

        jLabel6.setText("Juros:");

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.juro}"), txtJuros, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        txtJuros.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtJurosKeyTyped(evt);
            }
        });

        txtValorFinal.setEnabled(false);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.valorfinal}"), txtValorFinal, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        jLabel7.setText("Valor Final:");

        jLabel8.setText("Restante:");

        txtRestante.setEnabled(false);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, tblObjetos, org.jdesktop.beansbinding.ELProperty.create("${selectedElement.restante}"), txtRestante, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);

        txtDias.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtDiasKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtDiasKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtDiasKeyTyped(evt);
            }
        });

        javax.swing.GroupLayout pnlPagamentoLayout = new javax.swing.GroupLayout(pnlPagamento);
        pnlPagamento.setLayout(pnlPagamentoLayout);
        pnlPagamentoLayout.setHorizontalGroup(
            pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnlPagamentoLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addComponent(jLabel5)
                    .addComponent(jLabel8))
                .addGap(18, 18, 18)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtRestante, javax.swing.GroupLayout.DEFAULT_SIZE, 120, Short.MAX_VALUE)
                    .addComponent(txtRecebido, javax.swing.GroupLayout.DEFAULT_SIZE, 120, Short.MAX_VALUE)
                    .addComponent(txtDesconto))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 72, Short.MAX_VALUE)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4)
                    .addComponent(jLabel6)
                    .addComponent(jLabel7))
                .addGap(18, 18, 18)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtValorFinal, javax.swing.GroupLayout.DEFAULT_SIZE, 120, Short.MAX_VALUE)
                    .addComponent(txtValorVenda)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnlPagamentoLayout.createSequentialGroup()
                        .addComponent(txtDias, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(txtJuros, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        pnlPagamentoLayout.setVerticalGroup(
            pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlPagamentoLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(txtRecebido, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtValorVenda, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(txtDesconto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(txtJuros, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtDias, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(pnlPagamentoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtValorFinal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel7)
                    .addComponent(jLabel8)
                    .addComponent(txtRestante, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
        );

        jButton1.setText("Calcular");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        btnIniciaPagamento.setText("Fazer Pagamento");
        btnIniciaPagamento.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIniciaPagamentoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1)
                            .addComponent(jLabel2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(cbxFechamento, 0, 115, Short.MAX_VALUE)
                            .addComponent(cbxOrdem, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(txtFiltro)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(btnBuscas))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(btnAlterar)
                                .addGap(18, 18, 18)
                                .addComponent(jButton1)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(btnPagamento))))
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 531, Short.MAX_VALUE)
                    .addComponent(pnlPagamento, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnIniciaPagamento)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(cbxOrdem, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnBuscas)
                    .addComponent(txtFiltro, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 177, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btnIniciaPagamento)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(pnlPagamento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(cbxFechamento, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnAlterar)
                    .addComponent(btnPagamento)
                    .addComponent(jButton1))
                .addContainerGap())
        );

        bindingGroup.bind();

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnBuscasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnBuscasActionPerformed
        atualizaGridNome();
    }//GEN-LAST:event_btnBuscasActionPerformed

    private void btnTodosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTodosActionPerformed
        txtFiltro.setText(null);
        String sql = "from Vendaregistro pr";
        vendaRegistroQuery = entityManager.createQuery(sql);
        vendaRegistroList.clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
    }//GEN-LAST:event_btnTodosActionPerformed

    private void btnPendentesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPendentesActionPerformed
        txtFiltro.setText(null);
        String sql = "from Vendaregistro pr where ativo = 'Pendente'";
        vendaRegistroQuery = entityManager.createQuery(sql);
        vendaRegistroList.clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
    }//GEN-LAST:event_btnPendentesActionPerformed

    private void btnPagasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPagasActionPerformed
        txtFiltro.setText(null);
        String sql = "from Vendaregistro pr where ativo = 'Pago'";
        vendaRegistroQuery = entityManager.createQuery(sql);
        vendaRegistroList.clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
    }//GEN-LAST:event_btnPagasActionPerformed

    private void btnAlterarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAlterarActionPerformed
        int indexRegistro = tblObjetos.getSelectedRow();
        Vendaregistro obj = vendaRegistroList.get(indexRegistro);
        if (cbxFechamento.getSelectedItem().toString().equals("Fechar Venda")) {
            obj.setAtivo("Pago");
            entityManager.getTransaction().begin();
            entityManager.persist(obj);
            entityManager.getTransaction().commit();
            vendaRegistroList.clear();
            vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        }
        if (cbxFechamento.getSelectedItem().toString().equals("Abrir Venda")) {
            obj.setAtivo("Pendente");
            entityManager.getTransaction().begin();
            entityManager.persist(obj);
            entityManager.getTransaction().commit();
            vendaRegistroList.clear();
            vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        }
    }//GEN-LAST:event_btnAlterarActionPerformed

    private void btnPagamentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPagamentoActionPerformed
        int indexRegistro = tblObjetos.getSelectedRow();
        Vendaregistro obj = vendaRegistroList.get(indexRegistro);
        if (obj.getRestante() == 0) {
            obj.setAtivo("Pago");
            entityManager.persist(obj);
            vendaRegistroList.clear();
            vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
            tblObjetos.setRowSelectionInterval(indexRegistro, indexRegistro);
            tblObjetos.scrollRectToVisible(tblObjetos.getCellRect(indexRegistro, indexRegistro, true));
        }
        obj.setDesconto(0.0);
        obj.setJuro(0.0);
        obj.setRecebeu(0.0);
        entityManager.getTransaction().begin();
        entityManager.getTransaction().commit();
        vendaRegistroList.clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        dispose();
    }//GEN-LAST:event_btnPagamentoActionPerformed

    private void txtRecebidoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtRecebidoKeyTyped
        Uteis.validaCampoNumericoDouble(evt);
    }//GEN-LAST:event_txtRecebidoKeyTyped

    private void txtDescontoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDescontoKeyTyped
        Uteis.validaCampoNumericoDouble(evt);
    }//GEN-LAST:event_txtDescontoKeyTyped

    private void txtJurosKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtJurosKeyTyped
        Uteis.validaCampoNumericoDouble(evt);
    }//GEN-LAST:event_txtJurosKeyTyped

    private void txtRecebidoKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtRecebidoKeyReleased

    }//GEN-LAST:event_txtRecebidoKeyReleased

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        int indexRegistro = tblObjetos.getSelectedRow();
        Vendaregistro obj = vendaRegistroList.get(indexRegistro);
        if (Double.parseDouble(txtRecebido.getText()) <= obj.getRestante()) {
            resultado();
            btnPagamento.setEnabled(true);
        } else {
            JOptionPane.showMessageDialog(null, "Pagou mais do que deve", "Confira o Pagamento", 1);
            btnPagamento.setEnabled(false);
        }
    }//GEN-LAST:event_jButton1ActionPerformed

    private void txtRecebidoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtRecebidoFocusLost

//        int indexRegistro = tblObjetos.getSelectedRow();
//        Vendaregistro obj = vendaRegistroList.get(indexRegistro);
    }//GEN-LAST:event_txtRecebidoFocusLost

    private void btnIniciaPagamentoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIniciaPagamentoActionPerformed
        pnlPagamento.setEnabled(true);
    }//GEN-LAST:event_btnIniciaPagamentoActionPerformed

    private void txtDiasKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDiasKeyTyped

    }//GEN-LAST:event_txtDiasKeyTyped

    private void txtDiasKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDiasKeyPressed

    }//GEN-LAST:event_txtDiasKeyPressed

    private void txtDiasKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDiasKeyReleased
        int dias = Integer.parseInt(txtDias.getText());
        if (dias > 0) {
            BigDecimal valorDias = new BigDecimal(dias);
            BigDecimal jutosDia = new BigDecimal("0.3");
            BigDecimal calculaJuros = valorDias.multiply(jutosDia);
            txtJuros.setText(calculaJuros.toString());
        } else {
            txtJuros.setText("0.0");
        }
    }//GEN-LAST:event_txtDiasKeyReleased


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAlterar;
    private javax.swing.JButton btnAtrasadas;
    private javax.swing.JButton btnBuscas;
    private javax.swing.JButton btnIniciaPagamento;
    private javax.swing.JButton btnPagamento;
    private javax.swing.JButton btnPagas;
    private javax.swing.JButton btnPendentes;
    private javax.swing.JButton btnTodos;
    private javax.swing.JComboBox cbxFechamento;
    private javax.swing.JComboBox cbxOrdem;
    private java.util.List<br.com.tcc.entity.Cliente> clienteList;
    private javax.persistence.Query clienteQuery;
    private javax.persistence.EntityManager entityManager;
    private java.util.List<br.com.tcc.entity.Funcionario> funcionarioList;
    private javax.persistence.Query funcionarioQuery;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JPanel pnlPagamento;
    private javax.swing.JTable tblObjetos;
    private java.util.List<br.com.tcc.entity.Tipopagamento> tipoPagamentoList;
    private javax.persistence.Query tipoPagamentoQuery;
    private javax.swing.JTextField txtDesconto;
    private javax.swing.JTextField txtDias;
    private javax.swing.JTextField txtFiltro;
    private javax.swing.JTextField txtJuros;
    private javax.swing.JTextField txtRecebido;
    private javax.swing.JTextField txtRestante;
    private javax.swing.JTextField txtValorFinal;
    private javax.swing.JTextField txtValorVenda;
    private java.util.List<br.com.tcc.entity.Vendaregistro> vendaRegistroList;
    private javax.persistence.Query vendaRegistroQuery;
    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
    // End of variables declaration//GEN-END:variables
private void atualizaGridNome() {
        String sql = "from Vendaregistro pr";
        String ordem = "";
        if (cbxOrdem.getSelectedItem().toString().equals("Funcionário")) {
            ordem = "idFuncionario.nome";
        } else if (cbxOrdem.getSelectedItem().toString().equals("Cliente")) {
            ordem = "idCliente.nome";
        }
        String filtro = txtFiltro.getText();
        if (filtro.length() > 0 && filtro != null) {
            sql += " where upper(pr." + ordem + ") like '" + filtro.toUpperCase() + "%' ";
        }
//        sql += " order by " + "p.id desc";
        sql += " order by pr." + ordem;
        System.out.println("SQL Gerado: " + sql);
        vendaRegistroQuery = entityManager.createQuery(sql);
        vendaRegistroList.clear();
        vendaRegistroQuery.getResultList().clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        int row = vendaRegistroList.size() - 1;
        if (row >= 0) {
            tblObjetos.setRowSelectionInterval(row, row);
            tblObjetos.scrollRectToVisible(tblObjetos.getCellRect(row, row, true));
        }
    }

    public void resultado() {
        int indexRegistro = tblObjetos.getSelectedRow();
        Vendaregistro obj = vendaRegistroList.get(indexRegistro);
        double recebido = Double.parseDouble(txtRecebido.getText());
        double juros = Double.parseDouble(txtJuros.getText());
        double desconto = Double.parseDouble(txtDesconto.getText());

        double restante = vendaRegistroList.get(indexRegistro).getRestante() - recebido + juros - desconto;
        obj.setRestante(restante);
        obj.setRecebeu(recebido);
        obj.setDesconto(desconto);
        obj.setJuro(juros);
        entityManager.persist(obj);
        vendaRegistroList.clear();
        vendaRegistroList.addAll(vendaRegistroQuery.getResultList());
        tblObjetos.setRowSelectionInterval(indexRegistro, indexRegistro);
        tblObjetos.scrollRectToVisible(tblObjetos.getCellRect(indexRegistro, indexRegistro, true));

    }
}
